<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Greater Earth | Chronicles of Enoch</title>
    <meta name="description" content="Explore the world beyond the ice wall - an interactive map of the Greater Earth from The Chronicles of Enoch">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #c9a227;
            --gold-light: #e8d48b;
            --gold-dark: #8b6914;
            --parchment: #f4e4bc;
            --parchment-dark: #d4c4a0;
            --ink: #0a0a0f;
            --ink-light: #1a1a2f;
            --blood: #6b1c1c;
            --blood-light: #8b2c2c;
            --ocean-deep: #0a1628;
            --ice: #a8c8d8;
            --ice-glow: rgba(168, 200, 216, 0.4);
            --eden-green: #2a8b4a;
            --eden-glow: rgba(42, 139, 74, 0.4);
            --outer-blue: #4a7fff;
            --outer-glow: rgba(74, 127, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: var(--ink);
            color: var(--parchment);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* ==================== LOADING SCREEN ==================== */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--ink);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 1.5s ease, visibility 1.5s ease;
        }

        #loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loading-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--gold);
            letter-spacing: 0.4em;
            margin-bottom: 0.5rem;
            text-align: center;
            text-transform: uppercase;
        }

        .loading-subtitle {
            font-size: 1.1rem;
            color: var(--parchment-dark);
            font-style: italic;
            margin-bottom: 3rem;
            text-align: center;
            padding: 0 1rem;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            border-radius: 50%;
        }

        .loading-spinner::before {
            width: 100%;
            height: 100%;
            border: 2px solid rgba(201, 162, 39, 0.1);
            border-top-color: var(--gold);
            animation: spin 1.2s linear infinite;
        }

        .loading-spinner::after {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border: 2px solid rgba(201, 162, 39, 0.1);
            border-bottom-color: var(--gold-light);
            animation: spin 1.8s linear infinite reverse;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== HEADER ==================== */
        #header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem 1.5rem;
            background: linear-gradient(to bottom, rgba(10, 10, 15, 0.95), rgba(10, 10, 15, 0.8), transparent);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none;
        }

        #header > * {
            pointer-events: auto;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: clamp(0.8rem, 2.5vw, 1.1rem);
            font-weight: 600;
            color: var(--gold);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            text-decoration: none;
        }

        .logo-subtitle {
            font-size: 0.7rem;
            color: var(--parchment-dark);
            font-style: italic;
            letter-spacing: 0.1em;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn {
            font-family: 'Cinzel', serif;
            font-size: 0.6rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            padding: 0.5rem 1rem;
            background: rgba(10, 10, 15, 0.8);
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--parchment);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            background: rgba(201, 162, 39, 0.15);
            border-color: var(--gold);
        }

        .view-btn.active {
            background: var(--gold);
            color: var(--ink);
            border-color: var(--gold);
        }

        /* ==================== MAP CONTAINER ==================== */
        #map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            cursor: grab;
            background: radial-gradient(ellipse at center, #0a1628 0%, #050a14 100%);
        }

        #map-container:active {
            cursor: grabbing;
        }

        /* The map wrapper - this gets transformed */
        #map-wrapper {
            position: absolute;
            transform-origin: 0 0;
            will-change: transform;
        }

        /* The actual map image */
        #map-image {
            display: block;
            user-select: none;
            -webkit-user-drag: none;
        }

        /* ==================== LOCATION MARKERS ==================== */
        /* Markers are now INSIDE map-wrapper, so they move with the map */
        .marker {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s ease;
        }

        .marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 101;
        }

        .marker-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }

        .marker-dot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 5px;
            height: 5px;
            background: var(--ink);
            border-radius: 50%;
        }

        .marker-pulse {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 1px solid currentColor;
            border-radius: 50%;
            opacity: 0;
            animation: pulse 3s ease-out infinite;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0.6; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        .marker-label {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            white-space: nowrap;
            font-family: 'Cinzel', serif;
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gold);
            background: rgba(10, 10, 15, 0.95);
            padding: 4px 8px;
            border: 1px solid rgba(201, 162, 39, 0.4);
            opacity: 0;
            transition: opacity 0.3s ease, margin-bottom 0.3s ease;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        .marker:hover .marker-label {
            opacity: 1;
            margin-bottom: 12px;
        }

        /* Marker type colors */
        .marker-inner { color: var(--gold); }
        .marker-inner .marker-dot { background: var(--gold); }

        .marker-outer { color: var(--outer-blue); }
        .marker-outer .marker-dot { background: var(--outer-blue); }

        .marker-eden { color: var(--eden-green); }
        .marker-eden .marker-dot { background: var(--eden-green); }

        .marker-forbidden { color: var(--blood); }
        .marker-forbidden .marker-dot { background: var(--blood); }

        .marker-ice { color: var(--ice); }
        .marker-ice .marker-dot { background: var(--ice); }

        .marker-ancient { color: #9b59b6; }
        .marker-ancient .marker-dot { background: #9b59b6; }

        /* ==================== ZOOM CONTROLS ==================== */
        #zoom-controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 1000;
        }

        .zoom-btn {
            width: 44px;
            height: 44px;
            background: rgba(10, 10, 15, 0.9);
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--gold);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .zoom-btn:hover {
            background: rgba(201, 162, 39, 0.2);
            border-color: var(--gold);
        }

        /* ==================== INFO PANEL ==================== */
        #info-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            max-width: 90vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(15, 12, 8, 0.98), rgba(10, 22, 40, 0.98));
            z-index: 1500;
            padding: 0;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -10px 0 50px rgba(0, 0, 0, 0.5);
            border-left: 1px solid rgba(201, 162, 39, 0.2);
        }

        #info-panel.active {
            transform: translateX(0);
        }

        .panel-header {
            position: relative;
            padding: 2rem;
            background: linear-gradient(to bottom, rgba(201, 162, 39, 0.1), transparent);
            border-bottom: 1px solid rgba(201, 162, 39, 0.1);
        }

        .panel-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            background: transparent;
            border: 1px solid rgba(201, 162, 39, 0.3);
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .panel-close:hover {
            background: var(--gold);
            color: var(--ink);
        }

        .panel-region {
            font-family: 'Cinzel', serif;
            font-size: 0.65rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .panel-title {
            font-family: 'Cinzel', serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--parchment);
            line-height: 1.2;
        }

        .panel-content {
            padding: 1.5rem 2rem 2rem;
        }

        .panel-description {
            font-size: 1rem;
            line-height: 1.85;
            color: var(--parchment-dark);
            margin-bottom: 2rem;
        }

        .panel-description p {
            margin-bottom: 1rem;
        }

        .panel-description p:last-child {
            margin-bottom: 0;
        }

        .panel-description strong {
            color: var(--gold);
            font-weight: 500;
        }

        .panel-meta {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .meta-item {
            padding: 0.8rem 1rem;
            background: rgba(201, 162, 39, 0.03);
            border-left: 2px solid var(--gold);
        }

        .meta-label {
            font-family: 'Cinzel', serif;
            font-size: 0.55rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 0.25rem;
        }

        .meta-value {
            font-size: 0.9rem;
            color: var(--parchment);
            line-height: 1.5;
        }

        /* ==================== OVERLAY ==================== */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        #overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* ==================== INSTRUCTIONS ==================== */
        #instructions {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            z-index: 1000;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.7rem;
            color: var(--parchment-dark);
            opacity: 0.7;
        }

        .instruction {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .instruction kbd {
            display: inline-block;
            padding: 2px 6px;
            background: rgba(201, 162, 39, 0.1);
            border: 1px solid rgba(201, 162, 39, 0.3);
            border-radius: 3px;
            font-family: inherit;
            font-size: 0.6rem;
            color: var(--gold);
        }

        /* ==================== LEGEND ==================== */
        #legend {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
            font-size: 0.65rem;
            background: rgba(10, 10, 15, 0.9);
            padding: 0.6rem 1.2rem;
            border: 1px solid rgba(201, 162, 39, 0.2);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--parchment-dark);
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .legend-dot.inner { background: var(--gold); }
        .legend-dot.outer { background: var(--outer-blue); }
        .legend-dot.eden { background: var(--eden-green); }
        .legend-dot.forbidden { background: var(--blood); }
        .legend-dot.ancient { background: #9b59b6; }

        /* ==================== CROSS-SECTION VIEW ==================== */
        #cross-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--ink);
            z-index: 1800;
            display: none;
            flex-direction: column;
            padding: 2rem;
        }

        #cross-section.active {
            display: flex;
        }

        .cross-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .cross-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--gold);
            letter-spacing: 0.2em;
        }

        .cross-close {
            font-family: 'Cinzel', serif;
            font-size: 0.7rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 0.6rem 1.2rem;
            background: transparent;
            border: 1px solid var(--gold);
            color: var(--gold);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cross-close:hover {
            background: var(--gold);
            color: var(--ink);
        }

        .cross-diagram {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            border: 1px solid rgba(201, 162, 39, 0.2);
            overflow: hidden;
        }

        .layer {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 1rem;
        }

        .layer-name {
            font-family: 'Cinzel', serif;
            font-size: clamp(0.5rem, 1.5vw, 0.75rem);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            background: rgba(10, 10, 15, 0.8);
            padding: 0.3rem 0.8rem;
            position: absolute;
            left: 1rem;
        }

        .waters-above {
            flex: 0.8;
            background: linear-gradient(to bottom, #0a2040, #0a1628);
        }

        .firmament {
            flex: 0.5;
            background: linear-gradient(to bottom, 
                rgba(168, 200, 216, 0.2),
                rgba(201, 162, 39, 0.15),
                rgba(168, 200, 216, 0.2)
            );
            border-top: 2px solid var(--ice);
            border-bottom: 2px solid var(--ice);
        }

        .atmosphere {
            flex: 0.8;
            background: linear-gradient(to bottom, #1a2a3a, #3a4a5a);
        }

        .surface {
            flex: 1.5;
            background: linear-gradient(to bottom, #2a4a3a, #1a3a2a);
            position: relative;
        }

        .ice-walls {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 12%;
            background: linear-gradient(to bottom, var(--ice), #6a9aaa);
            box-shadow: 0 0 30px var(--ice-glow);
        }

        .ice-walls.left { left: 20%; }
        .ice-walls.right { right: 20%; }

        .surface-label {
            font-family: 'Cinzel', serif;
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            color: var(--gold);
            text-align: center;
        }

        .depths {
            flex: 1;
            background: linear-gradient(to bottom, #1a1a2a, #0a0a1a);
        }

        .waters-below {
            flex: 0.8;
            background: linear-gradient(to bottom, #0a1628, #050a14);
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            #info-panel {
                width: 100%;
            }

            #instructions {
                display: none;
            }

            #legend {
                font-size: 0.55rem;
                gap: 0.8rem;
                padding: 0.5rem 0.8rem;
            }

            .view-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.55rem;
            }

            #zoom-controls {
                bottom: 5rem;
                right: 1rem;
            }

            .zoom-btn {
                width: 38px;
                height: 38px;
            }
        }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen">
    <h1 class="loading-title">The Greater Earth</h1>
    <p class="loading-subtitle">"The world is not what humanity has been told..."</p>
    <div class="loading-spinner"></div>
</div>

<!-- Header -->
<header id="header">
    <div class="header-left">
        <a href="index.html" class="logo">The Greater Earth</a>
        <span class="logo-subtitle">Chronicles of Enoch</span>
    </div>
    <div class="view-controls">
        <button class="view-btn active" data-view="map">Map View</button>
        <button class="view-btn" data-view="cross">Cross-Section</button>
    </div>
</header>

<!-- Map Container -->
<div id="map-container">
    <div id="map-wrapper">
        <img id="map-image" src="Flat_Earth_map.jpg" alt="The World Beyond the Ice Wall">
        <!-- Markers will be injected here by JavaScript -->
    </div>
</div>

<!-- Zoom Controls -->
<div id="zoom-controls">
    <button class="zoom-btn" id="zoom-in" title="Zoom In">+</button>
    <button class="zoom-btn" id="zoom-out" title="Zoom Out">−</button>
    <button class="zoom-btn" id="zoom-reset" title="Reset View">⟲</button>
</div>

<!-- Instructions -->
<div id="instructions">
    <span class="instruction"><kbd>Drag</kbd> to pan</span>
    <span class="instruction"><kbd>Scroll</kbd> to zoom</span>
    <span class="instruction"><kbd>Click</kbd> markers to explore</span>
</div>

<!-- Legend -->
<div id="legend">
    <span class="legend-item"><span class="legend-dot inner"></span> Inner World</span>
    <span class="legend-item"><span class="legend-dot outer"></span> Outer Realms</span>
    <span class="legend-item"><span class="legend-dot eden"></span> Eden</span>
    <span class="legend-item"><span class="legend-dot forbidden"></span> Forbidden Zones</span>
    <span class="legend-item"><span class="legend-dot ancient"></span> Ancient Ruins</span>
</div>

<!-- Overlay -->
<div id="overlay"></div>

<!-- Info Panel -->
<div id="info-panel">
    <div class="panel-header">
        <button class="panel-close">×</button>
        <p class="panel-region" id="panel-region"></p>
        <h2 class="panel-title" id="panel-title"></h2>
    </div>
    <div class="panel-content">
        <div class="panel-description" id="panel-description"></div>
        <div class="panel-meta" id="panel-meta"></div>
    </div>
</div>

<!-- Cross-Section View -->
<div id="cross-section">
    <div class="cross-header">
        <h2 class="cross-title">The Structure of Creation</h2>
        <button class="cross-close">← Return to Map</button>
    </div>
    <div class="cross-diagram">
        <div class="layer waters-above">
            <span class="layer-name">The Waters Above</span>
        </div>
        <div class="layer firmament">
            <span class="layer-name">The Firmament (Raqia)</span>
        </div>
        <div class="layer atmosphere">
            <span class="layer-name">The Heavens (Sky)</span>
        </div>
        <div class="layer surface">
            <span class="layer-name">The Greater Earth</span>
            <div class="ice-walls left"></div>
            <div class="ice-walls right"></div>
            <span class="surface-label">Inner World</span>
        </div>
        <div class="layer depths">
            <span class="layer-name">The Depths (Sheol)</span>
        </div>
        <div class="layer waters-below">
            <span class="layer-name">The Waters Below</span>
        </div>
    </div>
</div>

<script>
// ============================================
// THE GREATER EARTH EXPLORER v2.0
// Chronicles of Enoch - Interactive World Map
// Fixed marker positioning + expanded locations
// ============================================

// Location data with ACCURATE positions on the map
// Coordinates are percentages of the map dimensions (0-100)
const locations = {
    // ==========================================
    // THE INNER WORLD (Within the Ice Wall)
    // ==========================================
    
    'nippur': {
        name: 'Nippur',
        region: 'The Inner World • Mesopotamia',
        x: 50.5, y: 49,
        type: 'inner',
        description: `<p>The city where <strong>Enoch</strong> lived and worked as a scribe. Here, on a rooftop overlooking the Euphrates, he first saw the burning letters that would change everything.</p>
        <p>Beneath these streets, the ancient gears still turn—mechanisms from before the Watchers descended, built by hands that knew the frequency of creation.</p>
        <p>This is where Sariel landed. Where Lila was born. Where the Chronicles began.</p>`,
        meta: {
            'Books': 'Book 1, 2, 3, 4',
            'Key Events': "Enoch's calling, Sariel's descent, Lila's birth",
            'Characters': 'Enoch, Lila, Namaah, Sariel',
            'Modern Location': 'Nuffar, Iraq'
        }
    },
    
    'ararat': {
        name: 'Mount Ararat',
        region: 'The Inner World • Mountains of the North',
        x: 51.5, y: 46,
        type: 'inner',
        description: `<p>Where the Ark came to rest after <strong>150 days</strong> of floating upon the waters of judgment. From this mountain, Noah's family descended to repopulate the cleansed world.</p>
        <p>The mountain still holds secrets—fragments of gopher wood, traces of the <strong>kopher</strong> that sealed the vessel, and the memory of eight souls who survived when all others perished.</p>
        <p>The covenant of the rainbow was established here—God's promise never to flood the inner world again.</p>`,
        meta: {
            'Books': 'Book 5, 6',
            'Key Events': 'The Landing, The Covenant',
            'Characters': 'Noah, Emzara, Shem, Ham, Japheth',
            'Significance': 'Site of humanity\'s second beginning'
        }
    },
    
    'babel': {
        name: 'Babel',
        region: 'The Inner World • Plain of Shinar',
        x: 50, y: 50.5,
        type: 'inner',
        description: `<p>The tower that almost pierced the firmament. Built with brick and <strong>bitumen</strong>—the same kopher that sealed the Ark, now perverted for rebellion.</p>
        <p>Here, <strong>Nimrod</strong> the mighty hunter (whose name means "we will rebel") united humanity under one language, one purpose—to make a name for themselves.</p>
        <p>God's response was not destruction but <strong>division</strong>. The confusion of tongues scattered humanity, ensuring no single power could again threaten the firmament.</p>`,
        meta: {
            'Books': 'Book 6',
            'Key Events': 'The Tower, The Confusion',
            'Characters': 'Nimrod, The Divine Council',
            'Lesson': 'Division, not destruction—the Silence learned from Atlantis'
        }
    },

    'ur': {
        name: 'Ur of the Chaldees',
        region: 'The Inner World • Mesopotamia',
        x: 51, y: 51,
        type: 'inner',
        description: `<p>Birthplace of <strong>Abram</strong>, who would become Abraham. Here, in a city of moon-worshippers, God called a man to leave everything and follow a promise.</p>
        <p>The ziggurat of Ur still stands in the desert—a monument to the gods humanity created in the Silence's image after Babel scattered the true knowledge.</p>`,
        meta: {
            'Books': 'Book 6',
            'Key Events': "Abram's Call",
            'Characters': 'Abraham, Terah',
            'Modern Location': 'Tell el-Muqayyar, Iraq'
        }
    },

    'jerusalem': {
        name: 'Salem / Jerusalem',
        region: 'The Inner World • Canaan',
        x: 49.5, y: 50,
        type: 'inner',
        description: `<p>The city of <strong>Melchizedek</strong>, priest of God Most High. Here Abraham paid tithes after rescuing Lot. Here David would reign. Here Solomon would build.</p>
        <p>The Temple Mount sits on the stone where Abraham nearly sacrificed Isaac—the same pattern echoing forward to another sacrifice, another Son.</p>`,
        meta: {
            'Books': 'Book 6, 7',
            'Key Events': "Melchizedek's Blessing, The Temple",
            'Characters': 'Melchizedek, Abraham, David, Solomon',
            'Significance': 'The frequency nexus of the inner world'
        }
    },

    'sodom': {
        name: 'Sodom',
        region: 'The Inner World • Cities of the Plain',
        x: 49.8, y: 51.5,
        type: 'forbidden',
        description: `<p>The city that burned with <strong>divine frequency</strong>. Not punishment alone—purification. The Silence had concentrated its corruption here until the Source responded.</p>
        <p>Lot's wife didn't simply die looking back. She was <strong>TRANSFORMED</strong>—exposed to raw creation frequency, her body crystallizing into the very salt that saturates this land.</p>
        <p>Mount Sodom is 80% pure salt. The Dead Sea is the scar.</p>`,
        meta: {
            'Books': 'Book 6',
            'Key Events': "Abraham's Intercession, The Fire",
            'Characters': 'Lot, Abraham, The Angels',
            'Evidence': 'Mount Sodom, Dead Sea region'
        }
    },

    'egypt': {
        name: 'Egypt',
        region: 'The Inner World • Land of the Nile',
        x: 48, y: 52,
        type: 'inner',
        description: `<p>The great civilization that rose after Babel's scattering. Home to <strong>Pharaoh's magicians</strong>—warlocks who could copy Moses' signs... to a point.</p>
        <p>At gnats, they failed. "This is the finger of God." Stolen power is finite. Channeled power is limitless.</p>
        <p>The pyramids hold older secrets—construction techniques that whisper of pre-Flood knowledge, preserved by those who remembered Lemuria.</p>`,
        meta: {
            'Books': 'Book 6, 7',
            'Key Events': 'The Exodus, The Plagues',
            'Characters': 'Moses, Pharaoh, The Magicians',
            'Mystery': 'How were the pyramids really built?'
        }
    },

    // ==========================================
    // THE OUTER REALMS (Beyond the Ice Wall)
    // ==========================================
    
    'asgard': {
        name: 'Asgard',
        region: 'The Outer Realms • Northwest',
        x: 28, y: 24,
        type: 'outer',
        description: `<p>Home to the <strong>Æsir</strong>—what Norse mythology remembers as gods. NOT gods, but ancient beings. Nephilim who fled the Flood? Watchers who retreated?</p>
        <p>Thor, Odin, Loki—real beings, misremembered as deities across thousands of years of fading memory. The Bifrost was not a rainbow bridge but a <strong>frequency pathway</strong>.</p>
        <p>The halls are largely abandoned now, but not empty. Something still watches from those ancient places.</p>`,
        meta: {
            'Nature': 'Realm of the Æsir',
            'Inhabitants': 'Nephilim refugees',
            'Status': 'Largely abandoned',
            'Connection': 'Norse mythology'
        }
    },

    'walls-of-asgard': {
        name: 'The Walls of Asgard',
        region: 'The Outer Realms • Northwest',
        x: 18, y: 28,
        type: 'ancient',
        description: `<p>Massive fortifications built to defend against... something. The scale suggests builders who were not merely human.</p>
        <p>These walls were not built to keep out armies. They were built to contain <strong>frequencies</strong>—or perhaps to keep them from spreading.</p>`,
        meta: {
            'Purpose': 'Frequency containment',
            'Builders': 'Unknown—possibly Nephilim',
            'Status': 'Partially standing'
        }
    },

    'titanic-forest': {
        name: 'The Titanic Forest',
        region: 'The Outer Realms • North',
        x: 50, y: 8,
        type: 'outer',
        description: `<p>Trees that dwarf redwoods. A forest where the Mother Trees still grow—the originals, the first frequency anchors planted by the Source at creation.</p>
        <p>The pre-Flood world had forests like this everywhere. Now only here, beyond the ice wall, do they survive untouched by the corruption of the Silence.</p>`,
        meta: {
            'Nature': 'Primordial forest',
            'Significance': 'Original Mother Trees',
            'Atmosphere': 'Higher oxygen, denser frequency'
        }
    },

    'skycaverns': {
        name: 'The Skycaverns',
        region: 'The Outer Realms • North',
        x: 60, y: 12,
        type: 'outer',
        description: `<p>Caves that open into the sky itself. Places where the firmament seems... thinner. Where the waters above can almost be touched.</p>
        <p>Some say the Watchers used these caverns as entry points when they descended. Others say they are exits—for those who learn the right frequency.</p>`,
        meta: {
            'Nature': 'Firmament weak points',
            'Access': 'Frequency-dependent',
            'Warning': 'Disorienting, dangerous'
        }
    },

    'aten': {
        name: 'Aten',
        region: 'The Outer Realms • North',
        x: 40, y: 18,
        type: 'outer',
        description: `<p>Land of <strong>Perpetual Light</strong>. The sun's path passes closer here than anywhere else on the Greater Earth.</p>
        <p>They remember the Watchers as <strong>TEACHERS</strong>, not corruptors—because they met them before the Fall, before the corruption, before the descent into darkness.</p>
        <p>Their astronomical knowledge exceeds anything preserved in the inner world. They mapped the firmament when humanity still lived in caves.</p>`,
        meta: {
            'Nature': 'Perpetual daylight',
            'Inhabitants': 'Pre-Flood civilization',
            'Knowledge': 'Advanced astronomy'
        }
    },

    'eden': {
        name: 'Eden',
        region: 'The Outer Realms • East',
        x: 77, y: 33,
        type: 'eden',
        description: `<p><strong>THE Garden.</strong> Still extant. Still guarded. The Cherubim with flaming swords patrol its borders—frequency barriers that no mortal from the inner world has crossed since Adam's expulsion.</p>
        <p>The <strong>Tree of Life</strong> still grows. The <strong>Tree of Knowledge</strong> still bears fruit. And somewhere within, Enoch continues his scribal work, recording what angels and men must not forget.</p>`,
        meta: {
            'Status': 'Guarded, inaccessible',
            'Guardians': 'Cherubim with flaming swords',
            'Known Inhabitant': 'Enoch (translated)',
            'Contents': 'Tree of Life, Tree of Knowledge'
        }
    },

    'terra-nova': {
        name: 'Terra Nova',
        region: 'The Outer Realms • East',
        x: 80, y: 45,
        type: 'outer',
        description: `<p>A land untouched by the Flood, untouched by corruption. Some say this is where humanity was meant to spread after Eden—the next garden, waiting.</p>
        <p>Expeditions from the inner world have tried to reach it. None have succeeded in returning with proof.</p>`,
        meta: {
            'Nature': 'Pristine land',
            'Status': 'Unexplored',
            'Theory': 'Intended expansion territory'
        }
    },

    'lemuria': {
        name: 'Lemuria',
        region: 'The Outer Realms • Northeast',
        x: 65, y: 22,
        type: 'ancient',
        description: `<p>The <strong>Sound Builders</strong>. They built with FREQUENCY before the Watchers taught humanity. Their structures resonate with the very hum of creation itself.</p>
        <p>The gears beneath the Euphrates may have been Lemurian design. The Chronophage—Lemurian technology, repurposed by those who did not understand its true function.</p>
        <p>Mostly fallen, but ruins remain—dangerous places where the old frequencies still echo, waiting to be reawakened.</p>`,
        meta: {
            'Technology': 'Frequency construction',
            'Status': 'Ruined, dangerous',
            'Connection': 'The Chronophage',
            'Warning': 'Unstable frequencies'
        }
    },

    'garden-isles': {
        name: 'The Garden Isles',
        region: 'The Outer Realms • Southeast',
        x: 73, y: 60,
        type: 'outer',
        description: `<p>Islands of impossible beauty, where plants grow in configurations unknown to the inner world. Some say seeds from Eden were scattered here during the first days.</p>
        <p>The air itself feels different—cleaner, more alive. As if the frequency of creation still hums stronger here than elsewhere.</p>`,
        meta: {
            'Nature': 'Edenic remnants',
            'Flora': 'Unknown species',
            'Atmosphere': 'Higher frequency'
        }
    },

    'mu': {
        name: 'Mu',
        region: 'The Outer Realms • Southeast',
        x: 82, y: 68,
        type: 'ancient',
        description: `<p>Once technologically advanced beyond any civilization that followed. They understood frequencies before anyone else. Then they reached for something they shouldn't have.</p>
        <p>It consumed them. The land itself seems... <strong>regretful</strong>. As if it remembers what was lost and grieves.</p>
        <p>The ruins contain dangerous knowledge. Some things are buried for good reason.</p>`,
        meta: {
            'Status': 'Destroyed (hubris)',
            'Cause': 'Forbidden knowledge',
            'Warning': 'Dangerous remnants'
        }
    },

    'horus': {
        name: 'Horus',
        region: 'The Outer Realms • South',
        x: 62, y: 65,
        type: 'outer',
        description: `<p>Named by early explorers who saw winged figures in the sky. Not gods—something else. Watchers who never fell? A different order of being entirely?</p>
        <p>The civilization here maintains careful records of every being that has passed through their lands. They know names that have been forgotten in the inner world for millennia.</p>`,
        meta: {
            'Inhabitants': 'Record-keepers',
            'Nature': 'Observation post',
            'Connection': 'The Watchers'
        }
    },

    'amun-ra': {
        name: 'Amun-Ra',
        region: 'The Outer Realms • South',
        x: 68, y: 58,
        type: 'outer',
        description: `<p>Where the sun rests closest to the outer realms. A land of light that mirrors Aten in the north. The two poles of the Greater Earth's illumination.</p>
        <p>The inhabitants here worship the Source—not as a distant god, but as a present frequency they can feel in every sunrise.</p>`,
        meta: {
            'Nature': 'Land of light',
            'Relation': 'Twin to Aten',
            'Worship': 'Source-focused'
        }
    },

    'atlantis': {
        name: 'Atlantis',
        region: 'The Outer Realms • South',
        x: 48, y: 75,
        type: 'forbidden',
        description: `<p>Not drowned by water. Destroyed by <strong>ANTI-FREQUENCY</strong>.</p>
        <p>The Atlanteans tried to breach the ice wall from outside. They had frequency knowledge that rivaled the Watchers. They were building something that could pierce the barrier.</p>
        <p>The Silence responded with a new weapon. It sang the <strong>opposite of creation</strong>. Ground turned to water. The city sank INTO THE LAND.</p>
        <p>The <strong>Eye of Africa</strong>—the Richat Structure—is the SCAR where Atlantis was swallowed.</p>`,
        meta: {
            'Destruction': 'Anti-frequency weapon',
            'Remnant': 'Eye of Africa (Richat Structure)',
            'Lesson': 'What the Silence learned, it used at Babel',
            'Warning': 'The anti-frequency still echoes'
        }
    },

    'glarnia': {
        name: 'Glarnia',
        region: 'The Outer Realms • Southwest',
        x: 38, y: 68,
        type: 'outer',
        description: `<p>A land of crystals that sing. The very stones here vibrate with stored frequencies—recordings of sounds made millennia ago, playing back for anyone who knows how to listen.</p>
        <p>Some crystals hold voices. Some hold music. Some hold screams.</p>`,
        meta: {
            'Nature': 'Crystal formations',
            'Phenomenon': 'Frequency storage',
            'Warning': 'Not all recordings should be heard'
        }
    },

    'polybius': {
        name: 'Polybius',
        region: 'The Outer Realms • West',
        x: 22, y: 55,
        type: 'ancient',
        description: `<p>Named for the Greek historian, though the ruins predate Greece by millennia. A civilization that documented everything—obsessively, compulsively.</p>
        <p>Their libraries may contain records of the pre-Flood world. If the texts can be deciphered. If the libraries can be found. If they haven't already been claimed by the Silence.</p>`,
        meta: {
            'Nature': 'Archive civilization',
            'Contents': 'Pre-Flood records (possibly)',
            'Status': 'Ruined, partially accessible'
        }
    },

    'weldrhom': {
        name: 'Weldrhom',
        region: 'The Outer Realms • West',
        x: 25, y: 48,
        type: 'outer',
        description: `<p>Where the outer ocean meets the land in storms that never end. A civilization of shipbuilders who navigate waters that would destroy inner-world vessels.</p>
        <p>They remember the Ark. They say their ancestors helped Noah build it.</p>`,
        meta: {
            'Nature': 'Storm-bound shores',
            'Inhabitants': 'Shipbuilders',
            'Legend': 'Ark construction knowledge'
        }
    },

    'atania': {
        name: 'Atania',
        region: 'The Outer Realms • West',
        x: 18, y: 40,
        type: 'outer',
        description: `<p>A land of miners who dig deep—too deep. They have found things in the earth that suggest other civilizations, other eras, buried beneath layers that should not exist.</p>
        <p>How many resets have there been? Atania's mines suggest more than the texts record.</p>`,
        meta: {
            'Industry': 'Deep mining',
            'Discoveries': 'Buried civilizations',
            'Question': 'How many resets?'
        }
    },

    'elwaar': {
        name: 'Elwaar',
        region: 'The Outer Realms • West',
        x: 15, y: 35,
        type: 'outer',
        description: `<p>Where the walls of Asgard end and something else begins. A transitional land, neither fully of Asgard's realm nor entirely separate.</p>
        <p>The beings here are hard to categorize. Not quite human. Not quite Nephilim. Something that emerged from the mixing of bloodlines over countless generations.</p>`,
        meta: {
            'Nature': 'Transitional zone',
            'Inhabitants': 'Mixed-lineage beings',
            'Status': 'Neutral territory'
        }
    },

    // ==========================================
    // THE FORBIDDEN ZONES
    // ==========================================

    'frozen-wastes': {
        name: 'The Frozen Wastes',
        region: 'The Forbidden Zones • Far Northeast',
        x: 88, y: 15,
        type: 'forbidden',
        description: `<p>Beyond even the outer realms. Perpetual cold, no life as we understand it. The silence here is <strong>absolute</strong>—no frequency at all.</p>
        <p>Some say this is where the Silence originated. Where anti-frequency was born. Where the void that existed before "Let there be light" still persists.</p>
        <p>Nothing that enters returns unchanged. Most do not return at all.</p>`,
        meta: {
            'Nature': 'Frequency void',
            'Temperature': 'Beyond cold',
            'Warning': 'Do not enter',
            'Theory': 'Origin of the Silence'
        }
    },

    'irradiated-wastes': {
        name: 'The Irradiated Wastes',
        region: 'The Forbidden Zones • Far West',
        x: 8, y: 38,
        type: 'forbidden',
        description: `<p>A region destroyed by some ancient weapon. Nothing grows. The land itself is poisoned. Even the Watchers cannot survive there long.</p>
        <p>What happened here, the texts do not say. Perhaps the war before the war. Perhaps a judgment that predates the Flood.</p>
        <p>Perhaps something that should <strong>never be remembered</strong>.</p>`,
        meta: {
            'Status': 'Uninhabitable',
            'Cause': 'Unknown ancient weapon',
            'Duration': 'Poisoned since before memory',
            'Warning': 'Even Watchers avoid this place'
        }
    },

    'scorched-wastes': {
        name: 'The Scorched Wastes',
        region: 'The Forbidden Zones • Southwest',
        x: 18, y: 72,
        type: 'forbidden',
        description: `<p>Burned, not by volcano but by something else. The ground is <strong>glass</strong> in places—vitrified by heat that should not exist outside the sun itself.</p>
        <p>Some connect this to Sodom's destruction—a preview of the judgment that would later fall on the Cities of the Plain. Or perhaps a test. The Silence learning what the Source could do.</p>`,
        meta: {
            'Status': 'Glassed terrain',
            'Cause': 'Unknown—divine fire?',
            'Connection': 'Sodom prototype?',
            'Warning': 'Ground unstable'
        }
    },

    'sunken-wastes': {
        name: 'The Sunken Wastes',
        region: 'The Forbidden Zones • South',
        x: 50, y: 85,
        type: 'forbidden',
        description: `<p>Land that is slowly <strong>drowning</strong>. Not flooded—SINKING. As if the earth itself is swallowing this region inch by inch, year by year.</p>
        <p>Connected to Atlantis's fate? The anti-frequency still working, still pulling downward? A wound in creation that has never healed?</p>`,
        meta: {
            'Status': 'Actively sinking',
            'Cause': 'Lingering anti-frequency',
            'Connection': 'Atlantis',
            'Warning': 'Ground unstable, expanding'
        }
    },

    'volcanic-wastes': {
        name: 'The Volcanic Wastes',
        region: 'The Forbidden Zones • East',
        x: 88, y: 50,
        type: 'forbidden',
        description: `<p>Where the earth bleeds fire. Constant eruptions, rivers of lava, air thick with ash. Some say this is where the foundations of the earth are weakest.</p>
        <p>Others say something is trying to break through from below. Something that was buried during the first creation. Something that wants out.</p>`,
        meta: {
            'Nature': 'Constant volcanic activity',
            'Theory': 'Weak point in creation',
            'Warning': 'Extreme danger',
            'Phenomenon': 'Something beneath?'
        }
    },

    'abyssal-ocean': {
        name: 'The Abyssal Ocean',
        region: 'The Forbidden Zones • Southeast',
        x: 75, y: 78,
        type: 'forbidden',
        description: `<p>Waters so deep they touch the Waters Below. Where the frequency barrier between layers grows thin. Where things swim that should not exist in any creation.</p>
        <p>Ships that sail here report seeing <strong>lights beneath</strong>—cities? Creatures? Something else entirely?</p>
        <p>The water here is denser. Wrong. It resists navigation as if it does not want visitors.</p>`,
        meta: {
            'Depth': 'Approaches Waters Below',
            'Phenomena': 'Lights beneath, dense water',
            'Navigation': 'Nearly impossible',
            'Warning': 'Ships do not return'
        }
    }
};

// ============================================
// MAP INITIALIZATION
// ============================================

const mapContainer = document.getElementById('map-container');
const mapWrapper = document.getElementById('map-wrapper');
const mapImage = document.getElementById('map-image');
const infoPanel = document.getElementById('info-panel');
const overlay = document.getElementById('overlay');
const loadingScreen = document.getElementById('loading-screen');

let scale = 1;
let translateX = 0;
let translateY = 0;
let isDragging = false;
let startX = 0;
let startY = 0;
let imgWidth = 0;
let imgHeight = 0;

const MIN_SCALE = 0.3;
const MAX_SCALE = 5;

// Wait for image to load
if (mapImage.complete) {
    initializeMap();
} else {
    mapImage.onload = initializeMap;
}

function initializeMap() {
    imgWidth = mapImage.naturalWidth;
    imgHeight = mapImage.naturalHeight;
    
    // Set wrapper size to match image
    mapWrapper.style.width = imgWidth + 'px';
    mapWrapper.style.height = imgHeight + 'px';
    
    // Center and fit the map
    fitMapToScreen();
    
    // Create markers INSIDE the map wrapper
    createMarkers();
    
    // Hide loading screen
    setTimeout(() => {
        loadingScreen.classList.add('hidden');
    }, 800);
}

function fitMapToScreen() {
    const containerWidth = mapContainer.clientWidth;
    const containerHeight = mapContainer.clientHeight;
    
    // Calculate scale to fit
    const scaleX = containerWidth / imgWidth;
    const scaleY = containerHeight / imgHeight;
    scale = Math.min(scaleX, scaleY) * 0.95;
    
    // Center the map
    const scaledWidth = imgWidth * scale;
    const scaledHeight = imgHeight * scale;
    translateX = (containerWidth - scaledWidth) / 2;
    translateY = (containerHeight - scaledHeight) / 2;
    
    updateTransform();
}

function updateTransform() {
    mapWrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

function createMarkers() {
    Object.entries(locations).forEach(([key, loc]) => {
        const marker = document.createElement('div');
        marker.className = `marker marker-${loc.type}`;
        marker.dataset.key = key;
        
        // Position based on percentage of image dimensions
        marker.style.left = (loc.x / 100 * imgWidth) + 'px';
        marker.style.top = (loc.y / 100 * imgHeight) + 'px';
        
        marker.innerHTML = `
            <div class="marker-pulse"></div>
            <div class="marker-dot"></div>
            <span class="marker-label">${loc.name}</span>
        `;
        
        marker.addEventListener('click', (e) => {
            e.stopPropagation();
            showInfo(key);
        });
        
        mapWrapper.appendChild(marker);
    });
}

// ============================================
// INTERACTION HANDLERS
// ============================================

// Mouse drag
mapContainer.addEventListener('mousedown', (e) => {
    if (e.target.closest('.marker')) return;
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    mapContainer.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    translateX = e.clientX - startX;
    translateY = e.clientY - startY;
    updateTransform();
});

document.addEventListener('mouseup', () => {
    isDragging = false;
    mapContainer.style.cursor = 'grab';
});

// Touch support
let lastTouchDistance = 0;

mapContainer.addEventListener('touchstart', (e) => {
    if (e.target.closest('.marker')) return;
    
    if (e.touches.length === 1) {
        isDragging = true;
        startX = e.touches[0].clientX - translateX;
        startY = e.touches[0].clientY - translateY;
    } else if (e.touches.length === 2) {
        isDragging = false;
        lastTouchDistance = getTouchDistance(e.touches);
    }
});

document.addEventListener('touchmove', (e) => {
    if (e.touches.length === 1 && isDragging) {
        translateX = e.touches[0].clientX - startX;
        translateY = e.touches[0].clientY - startY;
        updateTransform();
    } else if (e.touches.length === 2) {
        e.preventDefault();
        const newDistance = getTouchDistance(e.touches);
        const delta = newDistance / lastTouchDistance;
        
        const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
        const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
        
        zoomAt(centerX, centerY, delta);
        lastTouchDistance = newDistance;
    }
}, { passive: false });

document.addEventListener('touchend', () => {
    isDragging = false;
    lastTouchDistance = 0;
});

function getTouchDistance(touches) {
    const dx = touches[0].clientX - touches[1].clientX;
    const dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx * dx + dy * dy);
}

// Mouse wheel zoom
mapContainer.addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? 0.9 : 1.1;
    zoomAt(e.clientX, e.clientY, delta);
}, { passive: false });

function zoomAt(clientX, clientY, delta) {
    const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, scale * delta));
    if (newScale === scale) return;
    
    const rect = mapContainer.getBoundingClientRect();
    const mouseX = clientX - rect.left;
    const mouseY = clientY - rect.top;
    
    // Zoom toward mouse position
    const scaleChange = newScale / scale;
    translateX = mouseX - (mouseX - translateX) * scaleChange;
    translateY = mouseY - (mouseY - translateY) * scaleChange;
    scale = newScale;
    
    updateTransform();
}

// Zoom buttons
document.getElementById('zoom-in').addEventListener('click', () => {
    const rect = mapContainer.getBoundingClientRect();
    zoomAt(rect.width / 2, rect.height / 2, 1.3);
});

document.getElementById('zoom-out').addEventListener('click', () => {
    const rect = mapContainer.getBoundingClientRect();
    zoomAt(rect.width / 2, rect.height / 2, 0.7);
});

document.getElementById('zoom-reset').addEventListener('click', fitMapToScreen);

// ============================================
// INFO PANEL
// ============================================

function showInfo(key) {
    const loc = locations[key];
    if (!loc) return;
    
    document.getElementById('panel-region').textContent = loc.region;
    document.getElementById('panel-title').textContent = loc.name;
    document.getElementById('panel-description').innerHTML = loc.description;
    
    let metaHTML = '';
    for (const [label, value] of Object.entries(loc.meta)) {
        metaHTML += `
            <div class="meta-item">
                <p class="meta-label">${label}</p>
                <p class="meta-value">${value}</p>
            </div>
        `;
    }
    document.getElementById('panel-meta').innerHTML = metaHTML;
    
    infoPanel.classList.add('active');
    overlay.classList.add('active');
}

function closeInfo() {
    infoPanel.classList.remove('active');
    overlay.classList.remove('active');
}

document.querySelector('.panel-close').addEventListener('click', closeInfo);
overlay.addEventListener('click', closeInfo);

// ============================================
// VIEW SWITCHING
// ============================================

document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const view = btn.dataset.view;
        
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        if (view === 'cross') {
            document.getElementById('cross-section').classList.add('active');
        } else {
            document.getElementById('cross-section').classList.remove('active');
        }
    });
});

document.querySelector('.cross-close').addEventListener('click', () => {
    document.getElementById('cross-section').classList.remove('active');
    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('.view-btn[data-view="map"]').classList.add('active');
});

// ============================================
// KEYBOARD SHORTCUTS
// ============================================

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeInfo();
        document.getElementById('cross-section').classList.remove('active');
    }
    if (e.key === '+' || e.key === '=') {
        const rect = mapContainer.getBoundingClientRect();
        zoomAt(rect.width / 2, rect.height / 2, 1.2);
    }
    if (e.key === '-') {
        const rect = mapContainer.getBoundingClientRect();
        zoomAt(rect.width / 2, rect.height / 2, 0.8);
    }
    if (e.key === '0') {
        fitMapToScreen();
    }
});

// Window resize
window.addEventListener('resize', () => {
    // Recenter on resize
    fitMapToScreen();
});
</script>

</body>
</html>
